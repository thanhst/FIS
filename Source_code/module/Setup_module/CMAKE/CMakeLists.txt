cmake_minimum_required(VERSION 3.10)
project(FisaModule)

# ƒê·∫£m b·∫£o d√πng ƒë√∫ng compiler v√† ti√™u chu·∫©n C++
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

# T√¨m Python
find_package(Python3 REQUIRED COMPONENTS Interpreter Development)
find_package(pybind11 REQUIRED)

# X√°c ƒë·ªãnh th∆∞ m·ª•c include & phi√™n b·∫£n Python
execute_process(COMMAND ${Python3_EXECUTABLE} -c 
    "import sys; print('.'.join(map(str, sys.version_info[:2])))"
    OUTPUT_VARIABLE PYTHON_VERSION OUTPUT_STRIP_TRAILING_WHITESPACE)

# üîπ N·∫øu l·ªói v·∫´n x·∫£y ra, th·ª≠ **t·∫Øt** Py_LIMITED_API ƒë·ªÉ ƒë·∫£m b·∫£o t∆∞∆°ng th√≠ch
# add_definitions(-DPy_LIMITED_API=0x03060000)

# T·∫°o module Python
pybind11_add_module(fisa_module fisa_module.cpp)

# ƒê·∫£m b·∫£o module c√≥ th·ªÉ ch·∫°y v·ªõi m·ªçi Python 3.x
if(WIN32)
    set_target_properties(fisa_module PROPERTIES SUFFIX ".pyd" PREFIX "")
else()
    set_target_properties(fisa_module PROPERTIES SUFFIX ".so" PREFIX "")
endif()

message(STATUS "Building for Python ${PYTHON_VERSION}")
